"use strict";angular.module("blackjackApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap","blackjack.game"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),function(){angular.module("blackjack.game",["blackjack.card","blackjack.player","blackjack.dealer"])}(),function(){angular.module("blackjack.card",[])}(),function(){function a(){function a(){var a=new b;return a}function b(){var a=this;this.cards=[],this.dealt=[],a.suits.forEach(function(b){a.ranks.forEach(function(d){var e=new c(d,b);a.cards.push(e)})}),a.shuffle()}function c(a,b){this.rank=a,this.suit=b}var d={newDeck:a,Deck:b,Card:c};return b.prototype.suits=["C","D","S","H"],b.prototype.ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],b.prototype.deal=function(){var a=this.cards.shift();return angular.isDefined(a)?(this.dealt.push(a),a):!1},b.prototype.shuffle=function(){for(var a,b,c=this.cards.length;0!==c;)b=Math.floor(Math.random()*c),c-=1,a=this.cards[c],this.cards[c]=this.cards[b],this.cards[b]=a},b.prototype.reset=function(){this.cards=this.cards.concat(this.dealt),this.dealt=[],this.shuffle()},c.prototype.name=function(){return this.rank+this.suit},d}angular.module("blackjack.card").factory("CardService",a)}(),function(){function a(){return{restrict:"E",templateUrl:"app/card/card.directive.html",scope:{cardName:"@",cardState:"@",cardRank:"@",cardSuit:"@"},link:function(a,b,c){c.$observe("cardState",function(a){var c=b[0].querySelector(".card"),d=c.className;"backfacing"===a&&(c.className=d+" card--flipped")})}}}angular.module("blackjack.game").directive("blackjackCard",a)}(),function(){angular.module("blackjack.dealer",[])}(),function(){function a(a){function b(a){var b=new c(a);return b}function c(b){var c=this;c.deck=b,c.init=function(){c.cards=[],c.handValue=0,c.isDone=!1,c.busted=!1,c.maxValue=a.maxValue(),c.minValue=17},c.deal=function(){c.init(),c.hit(),c.hit()},c.finish=function(){for(;c.handValue<c.minValue;)c.hit();c.handValue>c.maxValue&&(c.busted=!0),c.isDone=!0},c.hit=function(){c.cards.push(c.deck.deal()),c.getHandValue()},c.getHandValue=function(){c.handValue=a.handValue(c.cards)},c.init()}var d={newDealer:b,Dealer:c};return d}angular.module("blackjack.dealer").factory("DealerService",a),a.$inject=["GameService"]}(),function(){function a(a,b,c,d){var e=this;e.init=function(){e.maxValue=c.maxValue(),e.canDeal=!1,e.started=!1,e.showResults=!1,e.deck=b.newDeck(),e.dealer=d.newDealer(e.deck),e.betValue=100,e.handValue=0,e.noPlayers=2,e.activePlayer=0},e.start=function(){var b=["Ray Charles","Frank Sinatra","James Brown"];e.players=[];for(var c=0;c<e.noPlayers;c++)e.players.push(a.newPlayer(b[c],100,c));e.started=!0,e.canDeal=!0,e.showResults=!1},e.resetPlayersState=function(){e.players.forEach(function(a){e.players[a.seatNo].cards=[],e.players[a.seatNo].handValue=0,e.players[a.seatNo].busted=!1,e.players[a.seatNo].won=!1})},e.deal=function(){e.busted=!1,e.started=!0,e.canDeal=!1,e.showResults=!1,e.activePlayer=0,e.resetPlayersState(),e.deck.shuffle(),e.players.forEach(function(a){e.players[a.seatNo].changeScore(-1*e.betValue),e.hit(a.seatNo),e.hit(a.seatNo)}),e.dealer.deal(),e.players[e.activePlayer].active=!0,console.log(e.players)},e.hit=function(a){e.players[a].cards.push(e.deck.deal()),e.getHandValue(a)},e.stay=function(){e.players[e.activePlayer].active=!1,e.activePlayer++,e.activePlayer===e.noPlayers?e.end():(e.canHit=!0,e.busted=!1,e.players[e.activePlayer].active=!0,e.getHandValue(e.activePlayer))},e.end=function(){e.dealer.finish(),e.players.forEach(function(a){var b=!1,c=!1,d=a.seatNo;e.dealer.busted?b=!0:e.dealer.handValue===a.handValue?c=!0:b=a.handValue>e.dealer.handValue,b&&!a.busted?(e.players[d].changeScore(2*e.betValue),e.players[d].won=!0,e.players[d].results="Congratulations, You Won!"):c?(e.players[d].changeScore(e.betValue),e.players[d].results="Push with the dealer!"):(e.results="DEALER WON",e.players[d].results="Dealer beat you!")}),e.canHit=!1,e.canDeal=!0,e.showResults=!0},e.reset=function(){e.players=[],e.init()},e.getHandValue=function(a){var b=c.handValue(e.players[a].cards);e.players[a].handValue=b,e.canHit=b<e.maxValue,e.busted=b>e.maxValue,e.busted&&(e.players[a].busted=!0,e.players[a].won=!1),b>=e.maxValue&&e.stay()},e.init()}angular.module("blackjack.game").controller("GameController",a),a.$inject=["PlayerService","CardService","GameService","DealerService"]}(),function(){function a(){return{restrict:"E",templateUrl:"app/game/game.directive.html",controller:"GameController",controllerAs:"game"}}angular.module("blackjack.game").directive("blackjackGame",a)}(),function(){function a(){function a(){return d}function b(a){var b=0,c=0,d=["J","Q","K"];a.forEach(function(a){-1!==d.indexOf(a.rank)?c+=10:"A"===a.rank?(c+=1,b++):c+=Number(a.rank)});for(var e=0;b>e;e++)11>=c&&(c+=10);return c}var c={handValue:b,maxValue:a},d=21;return c}angular.module("blackjack.game").factory("GameService",a)}(),angular.module("blackjackApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html"})}]),function(){angular.module("blackjack.player",[])}(),function(){function a(){function a(a,b,c){this.score=b,this.initialScore=b,this.name=a,this.handValue=0,this.seatNo=c,this.cards=[],this.busted=!1,this.won=!1,this.results="",this.active=!1}function b(b,c,d){var e=new a(b,c,d);return e}var c={newPlayer:b};return a.prototype.changeScore=function(a){angular.isDefined(this.score)||(this.score=this.initialScore),this.score+=a},a.prototype.resetScore=function(){this.score=this.initialScore},c}angular.module("blackjack.player").factory("PlayerService",a)}(),angular.module("blackjackApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("blackjackApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("blackjackApp").run(["$templateCache",function(a){a.put("app/card/card.directive.html","<section class=card-container><div class=card><figure class=card__front><span class=card__name>{{cardName}}</span></figure><figure class=card__back></figure></div></section>"),a.put("app/game/game.directive.html",'<div><!-- Game not started --><div ng-if=!game.started class="container align--center game--new"><h2>Press "Start" to play</h2><button class="btn btn-primary btn-lg" ng-click=game.start()>Start</button></div><div ng-if=game.started class="game game--started align--center"><!-- Card Table --><div class="panel panel-info"><div class=panel-heading><div ng-if=game.started>Game In Progress</div></div><div class=panel-body><div class="row row--dealer"><div ng-if=game.dealer.isDone><p>Dealer Hand: {{game.dealer.handValue}}</p></div><div ng-if=!game.dealer.isDone><p>Dealer</p></div><div class="well well-lg"><div ng-if="!game.dealer.isDone && game.dealer.cards.length > 0"><div class="row row--inline"><blackjack-card card-name={{game.dealer.cards[0].name()}}></blackjack-card></div><div class="row row--inline"><blackjack-card card-name={{game.dealer.cards[1].name()}} card-state=backfacing></blackjack-card></div></div><div ng-if=game.dealer.isDone class="row row--inline" ng-repeat="card in game.dealer.cards"><blackjack-card card-name={{card.name()}}></blackjack-card></div></div></div><div class="row row--players"><div ng-repeat="player in game.players" ng-class="{active: player.active}" class=player><div ng-if=game.started><p><span class=player-info>Player: {{player.name}}</span> <span class=player-info>Hand Value: {{player.handValue}}</span> <span class=player-info>Score: {{player.score}}</span></p></div><div ng-if=game.dealer.isDone><p>{{player.results}}</p></div><div class="well well-lg"><div class="row row--inline" ng-repeat="card in player.cards"><blackjack-card card-name={{card.name()}}></blackjack-card></div></div></div></div></div></div><!-- Game Actions --><div class="btn-group btn-group-justified btn-group--actions"><div class=btn-group role=group><button class="btn btn-primary" ng-click=game.deal() ng-disabled=!game.canDeal>Deal</button></div><div class=btn-group role=group><button class="btn btn-warning" ng-click=game.hit(game.activePlayer) ng-disabled=!game.canHit>HIT</button></div><div class=btn-group role=group><button class="btn btn-danger" ng-click=game.stay() ng-disabled=!game.canHit>STAY</button></div></div><button class="btn btn-danger btn--reset" ng-click=game.reset()>Reset Game</button></div></div>'),a.put("app/main/main.html","<div ng-include=\"'components/navbar/navbar.html'\"></div><header class=hero-unit id=banner><div class=container><h1>Blackjack</h1></div></header><div class=container><div class=row><blackjack-game></blackjack-game></div></div><footer class=footer><div class=container><p>Blackjack v1.0 | <a href=https://twitter.com/_antonioFazari>@_antonioFazari</a></p></div></footer>"),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>blackjack</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);